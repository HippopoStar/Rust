
use std::default::Default;
use std::fmt::{Debug, Display};

#[derive(Default)]
struct Puzzle<'a> {
    // Arrays p.67
    // Generic Structs with Lifetime Parameters p.221
    t: Vec<&'a[u8]>,
    v: [Vec<&'a[u8]>; 4],
    h: [Vec<&'a[u8]>; 4],
    b: Vec<&'a[u8]>,
}

// Byte Strings p.74; "slice.split(is_sep)" p.404; "String::from_utf8_lossy(byte_slice)" p.450
// "slice.lines()" p.445
// Associated Consts p.219
impl Puzzle<'_> {
    const DRAWING: &'static [u8] = br"
         ___________  ___________  ___________  ___________     ______________________________________________________ .
        |          _||          _||          _||          _|   |          _            _            _            _    |.
        |         |_ |         |_ |         |_ |         |_    |         | |          | |          | |          | |   |.
        |           ||_          ||_          ||_          |   |         | |__        | |__        | |__        | |__ |.
        |           | _|         | _|         | _|         |   |         |____|       |____|       |____|       |____||.
        |           ||_          ||_          ||_          |   |                                                      |.
        |           | _|         | _|         | _|         |   |______________________________________________________|.
        |  _______  ||  _______  ||  _______  ||  _______  |    ______________________________________________________ .
        | |_____  | || |  _____| || |  _____| || |  _____| |   |                                                      |.
        |  _____| | || | |_____  || | |_____  || | |_____  |   |                                                      |.
        | |  _____| || |_____  | || |_____  | || |_____  | |   |     I            I            I            I         |.
        | | |_____  ||  _____| | ||  _____| | ||  _____| | |   |                                                      |.
        | |_______| || |_______| || |_______| || |_______| |   |______________________________________________________|.
        |  _  ____  ||  _______  ||  _______  ||  _______  |    ______________________________________________________ .
        | | ||    | || |_____  | || |  _____| || |  _____| |   |                                                      |.
        | | || || | ||  _____| | || | |_____  || | |_____  |   |                                                      |.
        | | || || | || |  _____| || |_____  | || |_____  | |   |     I            I            I            I         |.
        | | || || | || | |_____  ||  _____| | ||  _____| | |   |                                                      |.
        | |____||_| || |_______| || |_______| || |_______| |   |______________________________________________________|.
        |  _  _  _  ||  _  ____  ||  _______  ||  _______  |    ______________________________________________________ .
        | | || || | || | ||    | || |_____  | || |  _____| |   |                                                      |.
        | | || || | || | || || | ||  _____| | || | |_____  |   |                                                      |.
        | |       | || | || || | || |  _____| || |_____  | |   |     I            I            I            I         |.
        | | || || | || | || || | || | |_____  ||  _____| | |   |                                                      |.
        | |_||_||_| || |____||_| || |_______| || |_______| |   |______________________________________________________|.
        |  _  _  _  ||  _  _  _  ||  _  ____  ||  _______  |    ______________________________________________________ .
        | | || || | || | || || | || | ||    | || |_____  | |   |                                                      |.
        | | || || | || | || || | || | || || | ||  _____| | |   |                                                      |.
        | |    || | || |       | || | || || | || |  _____| |   |     I            I            I            I         |.
        | | || || | || | || || | || | || || | || | |_____  |   |                                                      |.
        | |_||____| || |_||_||_| || |____||_| || |_______| |   |______________________________________________________|.
        |           ||           ||           ||           |                                                           .
        |           ||           ||           ||           |                                                           .
        |___________||___________||___________||___________|                                                           .
                                                                                                                       .
         ___________                                                                   ___________                     .
        |           |                                                                 |           |                    .
        |           |                                                                 |           |                    .
        |           |___________                ______________________________________|           |                    .
        |                       |              |            |            |                        |                    .
        |                       |              |                                                  |                    .
        |                       |______________|                                                  |                    .
        |                                                                                         |                    .
        |_________________________________________________________________________________________|                    .
        ";

    fn init(&mut self) {
        // "skip" p.12,365; "enumerate" p.39,354,371; "inspect" p.369
        // Slices p.77
        // Formatting Numbers p.457
        // Statics and Constants p.187
        const T_H: usize = 7; // top piece height
        const V_W: usize = 13; // vertical pieces width
        const V_H: usize = 34; // vertical pieces height
        const H_W: usize = 56; // horizontal pieces width
        const H_H: usize = 6; // horizontal pieces height
        const B_W: usize = 91; // bottom piece width
        const COLUMN: usize = (4 * V_W) + 3;
        Self::DRAWING
            .split(|c| b'\n' == *c)
            .skip(1)
            .take(44)
            .map(|l| &l[8..])
            .enumerate()
            .inspect(|(n, l)| println!("{:02} {}", n, String::from_utf8_lossy(l)))
            .for_each(|(n, l)| {
                if n < V_H {
                    for i in 0..4 {
                        self.v[i].push(&l[i * V_W..(i+1) * V_W]);
                    }
                    if n < T_H {
                        self.t.push(&l[COLUMN..COLUMN + H_W]);
                    }
                    else if n < T_H + (4 * H_H) {
                        self.h[(n - T_H) / H_H].push(&l[COLUMN..COLUMN + H_W]);
                    }
                }
                else if V_H < n {
                    self.b.push(&l[0..B_W]);
                }
            });
        // "chain" p.370; "fold" p.379
        // for it in (1..4).fold((&self.v[0]).iter(), |c, i| c.chain(&self.v[i])) {
        for i in 0..4 {
            for l in &self.v[i] {
                println!("{}", String::from_utf8_lossy(l));
            }
        }
        for i in 0..4 {
            for l in &self.h[i] {
                println!("{}", String::from_utf8_lossy(l));
            }
        }
        for l in &self.t {
            println!("{}", String::from_utf8_lossy(l));
        }
        for l in &self.b {
            println!("{}", String::from_utf8_lossy(l));
        }
    }
}

fn main() {
    println!("Hello, world!");
    let mut p = Puzzle::default();
    p.init();
}
